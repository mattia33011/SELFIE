@if (calendarOptions) {
<full-calendar
  #fullcalendar
  [options]="calendarOptions"
  [deepChangeDetection]="true"
  class="h-full"
>
  <ng-template #eventContent let-arg>
    <span class="w-full !text-left px-2 !text-nowrap">
      <h4 class="font-semibold text-xl truncate">{{ arg.event.title }}</h4>
      <p class="truncate">{{ arg.event.extendedProps.luogo }}</p>
    </span>
  </ng-template>
</full-calendar>
}

<p-dialog
  #updateEvents
  [header]="'event.eventHeader' | translate"
  [modal]="true"
  [(visible)]="visible"
  [style]="{ width: '25rem', height: '50rem' }"
  (onHide)="resetForm()"
>
  <div class="popup" *ngIf="visible">
    <div class="popup-container">
      <div class="flex-row">
        <div class="flex-item">
          <label for="isTask">{{ "event.isTask" | translate }}</label>
        </div>
        <div class="flex-item">
          <p-checkbox
            label="attivitÃ "
            [(ngModel)]="isTask"
            binary="true"
            (onChange)="onIsTaskChange()"
            aria-label="is Task"
          ></p-checkbox>
        </div>
        <div class="flex-item">
          <p-select-button
            *ngIf="isTask"
            [options]="taskStatuses"
            [(ngModel)]="taskStatus"
            aria-placeholder="Seleziona uno stato"
          ></p-select-button>
        </div>
      </div>
      <div class="flex-row">
        <div class="flex-item">
          <p-floatlabel variant="in">
            <input
              pInputText
              id="in_label"
              [(ngModel)]="eventName"
              pSize="small"
              autocomplete="off"
            />
            <label for="in_label">{{ "event.name" | translate }}</label>
          </p-floatlabel>
        </div>
        <div class="flex-item">
          <label for="eventColor">{{ "event.color" | translate }}</label>
          <p-colorpicker [(ngModel)]="eventColor" [appendTo]="updateEvents" />
        </div>
      </div>
      <div class="flex-row">
        <div class="flex-item">
          <p-iftalabel>
            <p-datepicker
              [(ngModel)]="theDate"
              inputId="date"
              showIcon
              iconDisplay="input"
              [appendTo]="updateEvents"
              />
            <label for="date">{{ "event.theDate" | translate }}</label>
          </p-iftalabel>
        </div>
        <div *ngIf="!isTask">
          <div
            *ngIf="!repeatUntil && (!repeatType || repeatType === 'once')"
            class="flex-item"
          >
            <div class="flex-item">
              <p-iftalabel>
                <p-datepicker
                  [(ngModel)]="eventEndDate"
                  inputId="end_date"
                  showIcon
                  iconDisplay="input"
                [appendTo]="updateEvents"
                />
                <label for="end_date">{{ "event.enddate" | translate }}</label>
              </p-iftalabel>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="!isTask">
        <div class="flex-row">
          <div class="flex-item">
            <p-iftalabel>
              <p-datepicker
                inputId="eventTime"
                [(ngModel)]="eventTime"
                [timeOnly]="true"
                [appendTo]="updateEvents"
              />
              <label for="eventTime">{{ "event.start" | translate }}</label>
            </p-iftalabel>
          </div>
          <div class="flex-item">
            <p-iftalabel>
              <p-datepicker
                inputId="endTime"
                [(ngModel)]="eventEndTime"
                [timeOnly]="true"
                [appendTo]="updateEvents"
              />
              <label for="eventEndTime">{{
                "event.endtime" | translate
              }}</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="flex-row justify-between">
          <div class="">
            <p-iftalabel>
              <label for="eventLocation">{{
                "event.location" | translate
              }}</label>
              <input
                type="eventLocation"
                pInputText
                [(ngModel)]="eventLocation"
              />
            </p-iftalabel>
          </div>
          @if(eventLocation && eventLocation.length > 0){
          <a [href]="generateLink(eventLocation)" target="_blank">
            <p-button icon="pi pi-map"></p-button>
          </a>
          }
        </div>

        <!-- Per la ripetizione -->
        <div class="flex-col items-left">
          <p-floatlabel class="w-full md:w-56" variant="in">
            <div class="repeat-grid">
              <button
                *ngFor="let option of repeatOptions"
                type="button"
                (click)="repeatType = option.value; onRepeatTypeChange()"
                [class.selected]="repeatType === option.value"
              >
                {{ option.label }}
              </button>
            </div>
          </p-floatlabel>
        </div>

        <!-- Se settimanale o bi-settimanale: mostra i giorni della settimana -->
        <div
          *ngIf="repeatType === 'weekly' || repeatType === 'biweekly'"
          class="giorni-ripetizione"
        >
          <div class="weekday-checkbox" *ngFor="let day of weekDays">
            <p-checkbox
              [binary]="true"
              [inputId]="day.value"
              [ngModel]="repeatWeekDays.includes(day.value)"
              (onChange)="toggleWeekday($event, day.value)"
            >
            </p-checkbox>
            <label [for]="day.value">{{ day.label }}</label>
          </div>
        </div>

        <!-- Data fine ripetizione -->
        <div
          *ngIf="repeatType && repeatType !== 'custom'"
          class="flex-col items-left"
        >
          <label for="repeatUntil">{{ "event.repeatUntil" | translate }}</label>
          <p-datepicker
            [(ngModel)]="repeatUntil"
            inputId="dateuntil"
            showIcon
            iconDisplay="input"
            [appendTo]="updateEvents"
            />
        </div>
      </div>
      <div class="form-group">
        <p-button
          *ngIf="!selectedEvent"
          label="{{ 'event.add' | translate }}"
          (click)="addEvent()"
        ></p-button>
        <p-button
          *ngIf="selectedEvent"
          label="{{ 'event.update' | translate }}"
          (click)="updateEvent()"
        ></p-button>
        <p-button
          *ngIf="selectedEvent"
          label="{{ 'event.delete' | translate }}"
          class="p-button-danger"
          (click)="deleteEvent()"
        ></p-button>
      </div>
    </div>
  </div>
</p-dialog>
